XIAOMI.namespace("mi3"),XIAOMI.mi3={tabSwitch:function(elms){var elmSwitch,elmContainer,elmContent,that=this;return 0===elms.length?elms:elms.length>1?(elms.each(function(){that.tabSwitch($(this))}),this):(elmSwitch=elms,elmContainer=elmSwitch.prev(".tab-container"),elmContent=elmContainer.children(".tab-content"),elmSwitch.on("click","li",function(){$(this).addClass("current").siblings().removeClass("current"),elmContent.eq(elmSwitch.children("li").index($(this))).removeClass("hide").siblings(".tab-content").addClass("hide")}),void 0)},versionSwitch:function(){$(".switch-td").on("click",function(e){e.preventDefault(),$(".version-wcdma").addClass("version-td").removeClass("version-wcdma")}),$(".switch-wcdma").on("click",function(e){e.preventDefault(),$(".version-td").addClass("version-wcdma").removeClass("version-td")})},versionMoreSwitch:function(){var _this=this,pa=$(".J_mi3_content");$(".moreSwitch-td").on("click",function(){_this.changeStylee(0),pa.addClass("block_hide").eq(0).removeClass("block_hide"),$(".version-wcdma").addClass("version-td").removeClass("version-wcdma")}),$(".moreSwitch-wcdma").on("click",function(){_this.changeStylee(0),pa.addClass("block_hide").eq(0).removeClass("block_hide"),$(".version-td").addClass("version-wcdma").removeClass("version-td")})},toogleBlock:function(){var pa=$(".J_mi3_content"),pb=$("#J_head_rightCon").children(".tab"),_this=this;pb.each(function(i){var index=i;$(this).click(function(){_this.changeStylee(index),pa.addClass("block_hide").eq(index).removeClass("block_hide")})})},changeHash:function(index){location.hash=this.tabs[index]},convertBlock:function(index,pa){pa.addClass("block_hide").eq(index).removeClass("block_hide")},hrefScroll:function(){var funs=["funA","funB","funC","funD","funE","funF","funG","funH","funI","funJ","funK","funL","funM","funN","funO","funP","funQ","funR","funS","funT","funU","funV","funW"],designs=["desA","desB","desC","desD","desE","desF"],miui=["miuiA","miuiB","miuiC","miuiD","miuiE","miuiF","miuiG","miuiH"],cloud=["cloudA","cloudB","cloudC","cloudD","cloudE","cloudF"],app=["appA","appB","appC","appD","appE","appF","appG","appH","appI","appJ"],_this=this,tabs=["overview","features","design","miui","micloud","fullspecs","app"];this.tabs=tabs;var callback=function(name){for(var i in funs)if(-1!==name.indexOf(funs[i])){_this.changeStylee(1);var pfuns=$(".J_mi3_content");return _this.convertBlock(1,pfuns),_this.scrollHeightById(".mi3-content-fn",i),void 0}for(var j in designs)if(-1!==name.indexOf(designs[j])){_this.changeStylee(2);var pdesigns=$(".J_mi3_content");return _this.convertBlock(2,pdesigns),_this.scrollHeightById(".mi3-content-design",j),void 0}for(var k in miui)if(-1!==name.indexOf(miui[k])){_this.changeStylee(3);var pmiui=$(".J_mi3_content");return _this.convertBlock(3,pmiui),_this.scrollHeightById(".mi3-content-miui",k),void 0}for(var a in cloud)if(-1!==name.indexOf(cloud[a])){_this.changeStylee(4);var pcloud=$(".J_mi3_content");return _this.convertBlock(4,pcloud),_this.scrollHeightById(".mi3-content-cloud",a),void 0}for(var b in app)if(-1!==name.indexOf(app[b])){_this.changeStylee(6);var papp=$(".J_mi3_content");return _this.convertBlock(6,papp),_this.scrollHeightById(".mi3-content-app",b),void 0}};$(".hpoint").click(function(){var name=$(this).attr("data-href");return callback(name),!1});var urlVal=location.href;callback(urlVal)},scrollHeightById:function(dom,i){var offset=$(dom).children(".section").eq(i).offset(),height=offset.top||0,obj=document.all||jQuery.browser.mozilla?"html":document.body;$(obj).animate({scrollTop:height},500)},videoclick:function(){var _this=this;$("#J_videolist").children("li").each(function(){var obj=$(this).find("a"),videodata=obj.attr("data-video");videodata&&$(this).click(function(){var video=$("#mi3_videowrap .modal-body"),videosrc=_this.getVideoCode(videodata);return videodata?(video.html(""),video.append(videosrc),$("#mi3_videowrap").modal("show").on("hidden",function(){video.html("")}),!1):void 0})}),$("#imgvideo").click(function(){var videodata=$(this).attr("data-video");if(videodata){var video=$("#mi3_videowrap .modal-body"),videosrc=_this.getVideoCode(videodata);return video.html(""),video.append(videosrc),$("#mi3_videowrap").modal("show").on("hidden",function(){video.html("")}),!1}})},getVideoCode:function(vediosrc){var iniHTML='<iframe height=348 width=530 src="http://player.youku.com/embed/'+vediosrc+'" frameborder=0 allowfullscreen></iframe>';return iniHTML},videoscroll:function(){var amount=$("#J_videolist").children("li").length,width=230*amount;$("#J_videolist").css("width",width),$("#imglistUp").click(function(){$("#J_videolist").animate({"margin-left":"0px"},300),$("#imglistDown").removeClass("rightforwardGray"),$("#imglistUp").addClass("leftforwardGray")}),$("#imglistDown").click(function(){$("#J_videolist").animate({"margin-left":"-460px"},300),$("#imglistDown").addClass("rightforwardGray"),$("#imglistUp").removeClass("leftforwardGray")})},navScroll:function(){var _this=this,pb=$("#J_head_rightCon2").children(".tab"),pa=$(".J_mi3_content");pb.each(function(i){var index=i;$(this).click(function(){_this.changeStylee(index),_this.convertBlock(index,pa);var obj=document.all||jQuery.browser.mozilla?"html":document.body;$(obj).animate({scrollTop:0},500)})})},changeStylee:function(i){$("#J_head_rightCon").children(".tab").removeClass("bold").eq(i).addClass("bold"),$("#J_head_rightCon2").children(".tab").removeClass("bold").eq(i).addClass("bold"),this.changeHash(i)}},jQuery(document).ready(function($){XIAOMI.mi3.tabSwitch($(".tab-switch")),XIAOMI.mi3.versionSwitch(),XIAOMI.mi3.versionMoreSwitch(),XIAOMI.mi3.toogleBlock(),XIAOMI.mi3.hrefScroll(),XIAOMI.mi3.videoclick(),XIAOMI.mi3.videoscroll(),XIAOMI.mi3.navScroll()}),function(){var $,Lightbox,LightboxOptions;$=jQuery,LightboxOptions=function(){function LightboxOptions(){this.fadeDuration=500,this.fitImagesInViewport=!0,this.resizeDuration=700,this.showImageNumberLabel=!0,this.wrapAround=!1}return LightboxOptions.prototype.albumLabel=function(curImageNum,albumSize){return"Image "+curImageNum+" of "+albumSize},LightboxOptions}(),Lightbox=function(){function Lightbox(options){this.options=options,this.album=[],this.currentImageIndex=void 0,this.init()}return Lightbox.prototype.init=function(){return this.enable(),this.build()},Lightbox.prototype.enable=function(){var _this=this;return $("body").on("click","a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]",function(e){return _this.start($(e.currentTarget)),!1})},Lightbox.prototype.build=function(){var _this=this;return $("<div id='lightboxOverlay' class='lightboxOverlay'></div><div id='lightbox' class='lightbox'><div class='lb-outerContainer'><div class='lb-container'><img class='lb-image' src='' /><div class='lb-nav'><a class='lb-prev' href='' ></a><a class='lb-next' href='' ></a></div><div class='lb-loader'><a class='lb-cancel'></a></div></div></div><div class='lb-dataContainer'><div class='lb-data'><div class='lb-details'><span class='lb-caption'></span><span class='lb-number'></span></div><div class='lb-closeContainer'><a class='lb-close'></a></div></div></div></div>").appendTo($("body")),this.$lightbox=$("#lightbox"),this.$overlay=$("#lightboxOverlay"),this.$outerContainer=this.$lightbox.find(".lb-outerContainer"),this.$container=this.$lightbox.find(".lb-container"),this.containerTopPadding=parseInt(this.$container.css("padding-top"),10),this.containerRightPadding=parseInt(this.$container.css("padding-right"),10),this.containerBottomPadding=parseInt(this.$container.css("padding-bottom"),10),this.containerLeftPadding=parseInt(this.$container.css("padding-left"),10),this.$overlay.hide().on("click",function(){return _this.end(),!1}),this.$lightbox.hide().on("click",function(e){return"lightbox"===$(e.target).attr("id")&&_this.end(),!1}),this.$outerContainer.on("click",function(e){return"lightbox"===$(e.target).attr("id")&&_this.end(),!1}),this.$lightbox.find(".lb-prev").on("click",function(){return 0===_this.currentImageIndex?_this.changeImage(_this.album.length-1):_this.changeImage(_this.currentImageIndex-1),!1}),this.$lightbox.find(".lb-next").on("click",function(){return _this.currentImageIndex===_this.album.length-1?_this.changeImage(0):_this.changeImage(_this.currentImageIndex+1),!1}),this.$lightbox.find(".lb-loader, .lb-close").on("click",function(){return _this.end(),!1})},Lightbox.prototype.start=function($link){var $window,a,dataLightboxValue,i,imageNumber,left,top,_i,_j,_len,_len1,_ref,_ref1;if($(window).on("resize",this.sizeOverlay),$("select, object, embed").css({visibility:"hidden"}),this.$overlay.width($(document).width()).height($(document).height()).fadeIn(this.options.fadeDuration),this.album=[],imageNumber=0,dataLightboxValue=$link.attr("data-lightbox"))for(_ref=$($link.prop("tagName")+'[data-lightbox="'+dataLightboxValue+'"]'),i=_i=0,_len=_ref.length;_len>_i;i=++_i)a=_ref[i],this.album.push({link:$(a).attr("href"),title:$(a).attr("title")}),$(a).attr("href")===$link.attr("href")&&(imageNumber=i);else if("lightbox"===$link.attr("rel"))this.album.push({link:$link.attr("href"),title:$link.attr("title")});else for(_ref1=$($link.prop("tagName")+'[rel="'+$link.attr("rel")+'"]'),i=_j=0,_len1=_ref1.length;_len1>_j;i=++_j)a=_ref1[i],this.album.push({link:$(a).attr("href"),title:$(a).attr("title")}),$(a).attr("href")===$link.attr("href")&&(imageNumber=i);$window=$(window),top=$window.scrollTop()+$window.height()/10,left=$window.scrollLeft(),this.$lightbox.css({top:top+"px",left:left+"px"}).fadeIn(this.options.fadeDuration),this.changeImage(imageNumber)},Lightbox.prototype.changeImage=function(imageNumber){var $image,preloader,_this=this;this.disableKeyboardNav(),$image=this.$lightbox.find(".lb-image"),this.sizeOverlay(),this.$overlay.fadeIn(this.options.fadeDuration),$(".lb-loader").fadeIn("slow"),this.$lightbox.find(".lb-image, .lb-nav, .lb-prev, .lb-next, .lb-dataContainer, .lb-numbers, .lb-caption").hide(),this.$outerContainer.addClass("animating"),preloader=new Image,preloader.onload=function(){var $preloader,imageHeight,imageWidth,maxImageHeight,maxImageWidth,windowHeight,windowWidth;return $image.attr("src",_this.album[imageNumber].link),$preloader=$(preloader),$image.width(preloader.width),$image.height(preloader.height),_this.options.fitImagesInViewport&&(windowWidth=$(window).width(),windowHeight=$(window).height(),maxImageWidth=windowWidth-_this.containerLeftPadding-_this.containerRightPadding-20,maxImageHeight=windowHeight-_this.containerTopPadding-_this.containerBottomPadding-110,(preloader.width>maxImageWidth||preloader.height>maxImageHeight)&&(preloader.width/maxImageWidth>preloader.height/maxImageHeight?(imageWidth=maxImageWidth,imageHeight=parseInt(preloader.height/(preloader.width/imageWidth),10),$image.width(imageWidth),$image.height(imageHeight)):(imageHeight=maxImageHeight,imageWidth=parseInt(preloader.width/(preloader.height/imageHeight),10),$image.width(imageWidth),$image.height(imageHeight)))),_this.sizeContainer($image.width(),$image.height())},preloader.src=this.album[imageNumber].link,this.currentImageIndex=imageNumber},Lightbox.prototype.sizeOverlay=function(){return $("#lightboxOverlay").width($(document).width()).height($(document).height())},Lightbox.prototype.sizeContainer=function(imageWidth,imageHeight){var newHeight,newWidth,oldHeight,oldWidth,_this=this;oldWidth=this.$outerContainer.outerWidth(),oldHeight=this.$outerContainer.outerHeight(),newWidth=imageWidth+this.containerLeftPadding+this.containerRightPadding,newHeight=imageHeight+this.containerTopPadding+this.containerBottomPadding,this.$outerContainer.animate({width:newWidth,height:newHeight},this.options.resizeDuration,"swing"),setTimeout(function(){_this.$lightbox.find(".lb-dataContainer").width(newWidth),_this.$lightbox.find(".lb-prevLink").height(newHeight),_this.$lightbox.find(".lb-nextLink").height(newHeight),_this.showImage()},this.options.resizeDuration)},Lightbox.prototype.showImage=function(){this.$lightbox.find(".lb-loader").hide(),this.$lightbox.find(".lb-image").fadeIn("slow"),this.updateNav(),this.updateDetails(),this.preloadNeighboringImages(),this.enableKeyboardNav()},Lightbox.prototype.updateNav=function(){this.$lightbox.find(".lb-nav").show(),this.album.length>1&&(this.options.wrapAround?this.$lightbox.find(".lb-prev, .lb-next").show():(this.currentImageIndex>0&&this.$lightbox.find(".lb-prev").show(),this.currentImageIndex<this.album.length-1&&this.$lightbox.find(".lb-next").show()))},Lightbox.prototype.updateDetails=function(){var _this=this;this.album[this.currentImageIndex].title!==void 0&&""!==this.album[this.currentImageIndex].title&&this.$lightbox.find(".lb-caption").html(this.album[this.currentImageIndex].title).fadeIn("fast"),this.album.length>1&&this.options.showImageNumberLabel?this.$lightbox.find(".lb-number").text(this.options.albumLabel(this.currentImageIndex+1,this.album.length)).fadeIn("fast"):this.$lightbox.find(".lb-number").hide(),this.$outerContainer.removeClass("animating"),this.$lightbox.find(".lb-dataContainer").fadeIn(this.resizeDuration,function(){return _this.sizeOverlay()})},Lightbox.prototype.preloadNeighboringImages=function(){var preloadNext,preloadPrev;this.album.length>this.currentImageIndex+1&&(preloadNext=new Image,preloadNext.src=this.album[this.currentImageIndex+1].link),this.currentImageIndex>0&&(preloadPrev=new Image,preloadPrev.src=this.album[this.currentImageIndex-1].link)},Lightbox.prototype.enableKeyboardNav=function(){$(document).on("keyup.keyboard",$.proxy(this.keyboardAction,this))},Lightbox.prototype.disableKeyboardNav=function(){$(document).off(".keyboard")},Lightbox.prototype.keyboardAction=function(event){var KEYCODE_ESC,KEYCODE_LEFTARROW,KEYCODE_RIGHTARROW,key,keycode;KEYCODE_ESC=27,KEYCODE_LEFTARROW=37,KEYCODE_RIGHTARROW=39,keycode=event.keyCode,key=String.fromCharCode(keycode).toLowerCase(),keycode===KEYCODE_ESC||key.match(/x|o|c/)?this.end():"p"===key||keycode===KEYCODE_LEFTARROW?0!==this.currentImageIndex&&this.changeImage(this.currentImageIndex-1):("n"===key||keycode===KEYCODE_RIGHTARROW)&&this.currentImageIndex!==this.album.length-1&&this.changeImage(this.currentImageIndex+1)},Lightbox.prototype.end=function(){return this.disableKeyboardNav(),$(window).off("resize",this.sizeOverlay),this.$lightbox.fadeOut(this.options.fadeDuration),this.$overlay.fadeOut(this.options.fadeDuration),$("select, object, embed").css({visibility:"visible"})},Lightbox}(),$(function(){var lightbox,options;return options=new LightboxOptions,lightbox=new Lightbox(options)})}.call(this);