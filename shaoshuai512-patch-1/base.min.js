/*! www.xiaomi.com - v1.0.0 - 2013-09-26-03 */if(XIAOMI===void 0||!XIAOMI)var XIAOMI={};XIAOMI.namespace=function(){var i,j,d,a=arguments,o=null;for(i=0;a.length>i;i+=1)for(d=(""+a[i]).split("."),o=XIAOMI,j="XIAOMI"==d[0]?1:0;d.length>j;j+=1)o[d[j]]=o[d[j]]||{},o=o[d[j]];return o},XIAOMI.lang=XIAOMI.lang||{},function(){var L=XIAOMI.lang,OP=Object.prototype,ARRAY_TOSTRING="[object Array]",FUNCTION_TOSTRING="[object Function]",OBJECT_TOSTRING="[object Object]",NOTHING=[],HTML_CHARS={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&#x60;"},ADD=["toString","valueOf"],OB={isArray:function(o){return OP.toString.apply(o)===ARRAY_TOSTRING},isBoolean:function(o){return"boolean"==typeof o},isFunction:function(o){return"function"==typeof o||OP.toString.apply(o)===FUNCTION_TOSTRING},isNull:function(o){return null===o},isNumber:function(o){return"number"==typeof o&&isFinite(o)},isObject:function(o){return o&&("object"==typeof o||L.isFunction(o))||!1},isString:function(o){return"string"==typeof o},isUndefined:function(o){return o===void 0},_IEEnumFix:-[1]?function(){}:function(r,s){var i,fname,f;for(i=0;ADD.length>i;i+=1)fname=ADD[i],f=s[fname],L.isFunction(f)&&f!=OP[fname]&&(r[fname]=f)},escapeHTML:function(html){return html.replace(/[&<>"'\/`]/g,function(match){return HTML_CHARS[match]})},extend:function(subc,superc,overrides){if(!superc||!subc)throw Error("extend failed, please check that all dependencies are included.");var i,F=function(){};if(F.prototype=superc.prototype,subc.prototype=new F,subc.prototype.constructor=subc,subc.superclass=superc.prototype,superc.prototype.constructor==OP.constructor&&(superc.prototype.constructor=superc),overrides){for(i in overrides)L.hasOwnProperty(overrides,i)&&(subc.prototype[i]=overrides[i]);L._IEEnumFix(subc.prototype,overrides)}},augmentObject:function(r,s){if(!s||!r)throw Error("Absorb failed, verify dependencies.");var i,p,a=arguments,overrideList=a[2];if(overrideList&&overrideList!==!0)for(i=2;a.length>i;i+=1)r[a[i]]=s[a[i]];else{for(p in s)!overrideList&&p in r||(r[p]=s[p]);L._IEEnumFix(r,s)}return r},augmentProto:function(r,s){if(!s||!r)throw Error("Augment failed, verify dependencies.");var i,a=[r.prototype,s.prototype];for(i=2;arguments.length>i;i+=1)a.push(arguments[i]);return L.augmentObject.apply(this,a),r},dump:function(o,d){var i,len,s=[],OBJ="{...}",FUN="f(){...}",COMMA=", ",ARROW=" => ";if(!L.isObject(o))return o+"";if(o instanceof Date||"nodeType"in o&&"tagName"in o)return o;if(L.isFunction(o))return FUN;if(d=L.isNumber(d)?d:3,L.isArray(o)){for(s.push("["),i=0,len=o.length;len>i;i+=1)L.isObject(o[i])?s.push(d>0?L.dump(o[i],d-1):OBJ):s.push(o[i]),s.push(COMMA);s.length>1&&s.pop(),s.push("]")}else{s.push("{");for(i in o)L.hasOwnProperty(o,i)&&(s.push(i+ARROW),L.isObject(o[i])?s.push(d>0?L.dump(o[i],d-1):OBJ):s.push(o[i]),s.push(COMMA));s.length>1&&s.pop(),s.push("}")}return s.join("")},substitute:function(s,o,f,recurse){for(var i,j,k,key,v,meta,token,dump,objstr,saved=[],lidx=s.length,DUMP="dump",SPACE=" ",LBRACE="{",RBRACE="}";(i=s.lastIndexOf(LBRACE,lidx),!(0>i))&&(j=s.indexOf(RBRACE,i),!(i+1>j));)token=s.substring(i+1,j),key=token,meta=null,k=key.indexOf(SPACE),k>-1&&(meta=key.substring(k+1),key=key.substring(0,k)),v=o[key],f&&(v=f(key,v,meta)),L.isObject(v)?L.isArray(v)?v=L.dump(v,parseInt(meta,10)):(meta=meta||"",dump=meta.indexOf(DUMP),dump>-1&&(meta=meta.substring(4)),objstr=""+v,v=objstr===OBJECT_TOSTRING||dump>-1?L.dump(v,parseInt(meta,10)):objstr):L.isString(v)||L.isNumber(v)||(v="~-"+saved.length+"-~",saved[saved.length]=token),s=s.substring(0,i)+v+s.substring(j+1),recurse===!1&&(lidx=i-1);for(i=saved.length-1;i>=0;i-=1)s=s.replace(RegExp("~-"+i+"-~"),"{"+saved[i]+"}","g");return s},trim:function(s){try{return s.replace(/^\s+|\s+$/g,"")}catch(e){return s}},merge:function(){var i,o={},a=arguments,l=a.length;for(i=0;l>i;i+=1)L.augmentObject(o,a[i],!0);return o},later:function(when,o,fn,data,periodic){when=when||0,o=o||{};var f,r,m=fn,d=data;if(L.isString(fn)&&(m=o[fn]),!m)throw new TypeError("method undefined");return L.isUndefined(data)||L.isArray(d)||(d=[data]),f=function(){m.apply(o,d||NOTHING)},r=periodic?setInterval(f,when):setTimeout(f,when),{interval:periodic,cancel:function(){this.interval?clearInterval(r):clearTimeout(r)}}},isValue:function(o){return L.isObject(o)||L.isString(o)||L.isNumber(o)||L.isBoolean(o)}};L.hasOwnProperty=OP.hasOwnProperty?function(o,prop){return o&&o.hasOwnProperty&&o.hasOwnProperty(prop)}:function(o,prop){return!L.isUndefined(o[prop])&&o.constructor.prototype[prop]!==o[prop]},OB.augmentObject(L,OB,!0),L.augment=L.augmentProto,XIAOMI.augment=L.augmentProto,XIAOMI.extend=L.extend}();;(function(){function parse(s,buf,offset){var i=buf&&offset||0,ii=0;for(buf=buf||[],s.toLowerCase().replace(/[0-9a-f]{2}/g,function(oct){16>ii&&(buf[i+ii++]=_hexToByte[oct])});16>ii;)buf[i+ii++]=0;return buf}function unparse(buf,offset){var i=offset||0,bth=_byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}function v1(options,buf,offset){var i=buf&&offset||0,b=buf||[];options=options||{};var clockseq=null!=options.clockseq?options.clockseq:_clockseq,msecs=null!=options.msecs?options.msecs:(new Date).getTime(),nsecs=null!=options.nsecs?options.nsecs:_lastNSecs+1,dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(0>dt&&null==options.clockseq&&(clockseq=16383&clockseq+1),(0>dt||msecs>_lastMSecs)&&null==options.nsecs&&(nsecs=0),nsecs>=1e4)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=msecs,_lastNSecs=nsecs,_clockseq=clockseq,msecs+=122192928e5;var tl=(1e4*(268435455&msecs)+nsecs)%4294967296;b[i++]=255&tl>>>24,b[i++]=255&tl>>>16,b[i++]=255&tl>>>8,b[i++]=255&tl;var tmh=268435455&1e4*(msecs/4294967296);b[i++]=255&tmh>>>8,b[i++]=255&tmh,b[i++]=16|15&tmh>>>24,b[i++]=255&tmh>>>16,b[i++]=128|clockseq>>>8,b[i++]=255&clockseq;for(var node=options.node||_nodeId,n=0;6>n;n++)b[i+n]=node[n];return buf?buf:unparse(b)}function v4(options,buf,offset){var i=buf&&offset||0;"string"==typeof options&&(buf="binary"==options?new BufferClass(16):null,options=null),options=options||{};var rnds=options.random||(options.rng||_rng)();if(rnds[6]=64|15&rnds[6],rnds[8]=128|63&rnds[8],buf)for(var ii=0;16>ii;ii++)buf[i+ii]=rnds[ii];return buf||unparse(rnds)}var _rng,_global=this;if("function"==typeof require)try{var _rb=require("crypto").randomBytes;_rng=_rb&&function(){return _rb(16)}}catch(e){}if(!_rng&&_global.crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);_rng=function(){return crypto.getRandomValues(_rnds8),_rnds8}}if(!_rng){var _rnds=Array(16);_rng=function(){for(var r,i=0;16>i;i++)0===(3&i)&&(r=4294967296*Math.random()),_rnds[i]=255&r>>>((3&i)<<3);return _rnds}}for(var BufferClass="function"==typeof Buffer?Buffer:Array,_byteToHex=[],_hexToByte={},i=0;256>i;i++)_byteToHex[i]=(i+256).toString(16).substr(1),_hexToByte[_byteToHex[i]]=i;var _seedBytes=_rng(),_nodeId=[1|_seedBytes[0],_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]],_clockseq=16383&(_seedBytes[6]<<8|_seedBytes[7]),_lastMSecs=0,_lastNSecs=0,uuid=v4;if(uuid.v1=v1,uuid.v4=v4,uuid.parse=parse,uuid.unparse=unparse,uuid.BufferClass=BufferClass,_global.define&&define.amd)define(function(){return uuid});else if("undefined"!=typeof module&&module.exports)module.exports=uuid;else{var _previousRoot=_global.uuid;uuid.noConflict=function(){return _global.uuid=_previousRoot,uuid},_global.uuid=uuid}}).call(this);;(function(){for(var method,noop=function(){},methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],length=methods.length,console=window.console=window.console||{};length--;)method=methods[length],console[method]||(console[method]=noop)})(),XIAOMI.namespace("app.miniLogin, app.cookie, app.lazyLoad, app.setLoginInfo, app.updateMiniCart, app.Recommend, app.History,app.addShopCart,app.addShopCartEvent,app.search,app.miniCart,app.getRegions,app.selector,XIAOMI.app.navigation,app.header,app.countdown,app.googleAnalytics"),XIAOMI.lang.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},XIAOMI.app.miniLogin=function(){this.orderSite=XIAOMI.GLOBAL_CONFIG.orderSite,this.quickLoginUrl=XIAOMI.GLOBAL_CONFIG.quickLoginUrl},XIAOMI.app.miniLogin.prototype={constructor:XIAOMI.app.miniLogin,_proxyiframe:function(){var iframesrc=this.orderSite+"/user/proxy/stop/1",iframebody="<iframe src='"+iframesrc+"' width='0' height='0' name='proxy' id='proxy' frameborder='0' scrolling='no'></iframe>";$(document.body).append(iframebody),$("iframe[name='proxy']").load(function(){$("iframe[name='proxy']").remove()})},_toLogin:function(rel){function appendTobody(url){var iframeURL=url?url:_this.quickLoginUrl,content="<iframe src='"+iframeURL+"' width='100%' height='100%' name='miniLoginFrame' id='miniLoginFrame' frameborder='0' scrolling='no'></iframe>",boxWidth=XIAOMI.app.cookie("sns_type")?$("#loginBox").attr("data-width-sns"):$("#loginBox").attr("data-width"),boxHeight=$("#loginBox").attr("data-Height");$("#loginBox-con").css({height:boxHeight}).html(content),XIAOMI.app.cookie("sns_type")&&$("#loginBox-con").css({"padding-left":"100px"}),$("#loginBox").css({width:boxWidth}).modal({backdrop:!0,keyboard:!0,show:!0})}function goLocation(){clearInterval(timer),rel?window.location.href=rel:window.location.reload(!0)}function checkHash(){-1!==window.location.href.indexOf("order")?XIAOMI.app.cookie("serviceToken")&&goLocation():XIAOMI.app.cookie("userId")&&goLocation()}var _this=this,shref=encodeURIComponent(window.location.href);$.ajax({url:_this.orderSite+"/site/loginurl?followup="+shref,dataType:"jsonp",jsonp:"jsonpcallback",success:function(data){appendTobody(data.url)},Complete:function(){},error:function(){appendTobody()}});var timer=window.setInterval(checkHash,1e3)},init:function(){var _this=this;-1!==window.location.pathname.indexOf("cart")&&XIAOMI.app.cookie("userId")&&!XIAOMI.app.cookie("serviceToken")&&_this._proxyiframe(),$("[data-needLogin='true']").live("click",function(e){var rel=$(this).attr("data-rel");_this._isLogined(rel,e)})},_isLogined:function(rel,e){XIAOMI.app.cookie("serviceToken")||(XIAOMI.app.cookie("userId")?this._proxyiframe():(e&&XIAOMI.lang.preventDefault(e),this._toLogin(rel)))},autoExec:function(rel){this._isLogined(rel)}},XIAOMI.app.cookie=function(key,value,options){if(arguments.length>1&&"[object Object]"!=value+""){if(options=jQuery.extend({},options),(null===value||void 0===value)&&(options.expires=-1),"number"==typeof options.expires){var days=options.expires,t=options.expires=new Date;t.setDate(t.getDate()+days)}return value+="",document.cookie=[encodeURIComponent(key),"=",options.raw?value:encodeURIComponent(value),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}options=value||{};var result,decode=options.raw?function(s){return s}:decodeURIComponent;return(result=RegExp("(?:^|; )"+encodeURIComponent(key)+"=([^;]*)").exec(document.cookie))?decode(result[1]):null},XIAOMI.app.googleAnalytics=function(element,options){this.options={page:"首页",mstPage:"H",mstFunction:"A",mstPosition:["A1"],position:["A1"],url:!0,isMst:!1,JQelement:!1};for(var p in options)this.options[p]=options[p];for(var _this=this,isUrl=_this.options.url?!0:!1,bindFunction=function(links){$.each(links,function(k,v){var paramString=isUrl?$(v).attr("href"):XIAOMI.lang.trim($(v).text()),paramIndex=k,GAparmas="'"+_this.options.page+"', '"+_this.options.position[i]+"_"+paramIndex+"','"+paramString+"'",mstParmas="'"+_this.options.mstPage+"', '"+_this.options.mstPage+"-"+_this.options.mstFunction+"-"+_this.options.position[i]+"_"+paramIndex+"','"+paramString+"'";_this.options.isMst?$(v).attr("onclick","_gaq.push(['_trackEvent',"+GAparmas+"]);_msq.push(['trackEvent',event,"+mstParmas+"])"):$(v).attr("onclick","_gaq.push(['_trackEvent',"+GAparmas+"]);")})},i=0;element.length>i;i++){var links=_this.options.JQelement?element:$(element[i]).find("a");bindFunction(links)}},XIAOMI.app.lazyLoad=function(option){var settings={defObj:"#lazyLoad-box",defHeight:50};settings=$.extend(settings,option||{});var defObj=(settings.defHeight,"object"==typeof settings.defObj?settings.defObj.find("img"):$(settings.defObj).find("img")),isIpad="ipad"===navigator.userAgent.toLowerCase().match(/iPad/i)?!0:!1,pageTop=function(){var d=document,y=isIpad?window.pageYOffset:Math.max(d.documentElement.scrollTop,d.body.scrollTop);return isIpad&&(settings.defHeight=0),d.documentElement.clientHeight+y-settings.defHeight},rechangeSrc=function(obj){var src2=obj.attr("src2");src2&&obj.css({opacity:"0.3"}).attr("src",src2).removeAttr("src2").animate({opacity:"1"})},imgLoad=function(){defObj.each(function(){isIpad?rechangeSrc($(this)):$(this).offset().top<=pageTop()&&rechangeSrc($(this))})};imgLoad(),$(window).bind("scroll",function(){imgLoad()}),$(window).bind("resize",function(){imgLoad()})},XIAOMI.app.setLoginInfo={data:{userId:0,userName:"",goodsNum:0},miid:XIAOMI.app.cookie("userId"),init:function(){if(this.data.userId=this.miid,this.uuidCookie(),this.data.userId)if(this.data.userName=this.miid?XIAOMI.app.cookie("XM_"+this.miid+"_UN"):"",this.data.goodsNum=XIAOMI.app.cookie("xm_user_www_num"),this.data.goodsNum=null==this.data.goodsNum?0:this.data.goodsNum,null==this.data.userName||""===this.data.userName){var script=document.createElement("script");script.src="https://account.xiaomi.com/pass/userInfoJsonP?userId="+this.miid+"&callback=XIAOMI.app.setLoginInfo.getAccountInfo",script.type="text/javascript",script.async=!0,document.getElementsByTagName("head")[0].appendChild(script)}else this.updateDom()},updateDom:function(){var tmpname="";tmpname=this.data.userName.length>7?this.data.userName.substr(0,7)+"...":this.data.userName;var html=' <span class="header_menu_top_login_user" style="padding-right: 15px;background-image: url(http://p.www.xiaomi.com/zt/130923/tridown2.png?130923);background-repeat: no-repeat;background-position: right 3px;"><strong>'+tmpname+'</strong></span><a class="no_border" href="'+this.orderUrl+'"></a>',_this=this;$("#header_menu_top_login").html(html),$("#header_menu_top_order").show();var timeOut=null;$("#header_menu_top_panelUsername").html(tmpname),$("#header_menu_top_panelexit").html("<a  href="+this.orderUrl+">退出登录</a>"),_this=$(".header_menu_top_panel"),$("#header_menu_top_login").hover(function(){var width=$(this).parent().width();console.log(width+":");var panel_width=width+30;96>panel_width&&(panel_width=96);var margin_left=-((panel_width+6)/2);$(".header_menu_top_panel").css("width",panel_width),$(".header_menu_top_panel").css("margin-left",margin_left),clearTimeout(timeOut),_this.slideDown(200),XIAOMI.app.miniCart.close()},function(){timeOut=setTimeout(function(){_this.hide()},500)}),$(".header_menu_top_panel").hover(function(){clearTimeout(timeOut),_this.show()},function(){timeOut=setTimeout(function(){_this.hide()},500)})},getAccountInfo:function(data){if(data.userId){this.data.userName=data.uniqName?data.uniqName:data.userId;var option={path:"/",domain:".xiaomi.com"};XIAOMI.app.cookie("XM_"+this.miid+"_UN",this.data.userName,option),this.updateDom()}},uuidCookie:function(){var myUuidValue=("xmguest-"+uuid.v1()).toUpperCase(),myUuid=XIAOMI.app.cookie("xmuuid");if(!myUuid){var option={path:"/",domain:".xiaomi.com",expires:18250};XIAOMI.app.cookie("xmuuid",myUuidValue,option)}}},XIAOMI.app.updateMiniCart=function(){var num=XIAOMI.app.cookie("xm_user_www_num");return num&&parseFloat(num)>0?($("#miniCartNum").html(num).show(),num):($("#miniCartNum").html("0").hide(),0)},XIAOMI.app.Recommend=function(options){var config={obj:$("#xmRecommend"),list:$("#xmRecommendList"),prevBtn:$("#xmRecommendPrev"),nextBtn:$("#xmRecommendNext"),itemW:null,autoPlay:!0,speed:5e3};$.extend(config,options||{});var lens=config.list.find("li").length,itemW=config.itemW||config.list.find("li").outerWidth(),objW=config.obj.width(),i=Math.floor(objW/itemW),curr=1,ap=config.autoPlay,s=config.speed,apTimer=null;config.obj.css({height:config.list.find("li").outerHeight()-1}),config.list.css({width:itemW*lens,"margin-left":0});var countPage=Math.ceil(lens/i);config.prevBtn.addClass("disabled"),1>=countPage?config.nextBtn.addClass("disabled"):config.nextBtn.removeClass("disabled");var play=function(p){var ml="-"+(p-1)*itemW*i+"px";config.list.animate({"margin-left":ml},500),countPage>p&&p>1?(config.prevBtn.removeClass("disabled"),config.nextBtn.removeClass("disabled")):1===p?(config.prevBtn.addClass("disabled"),config.nextBtn.removeClass("disabled")):p===countPage&&(config.prevBtn.removeClass("disabled"),config.nextBtn.addClass("disabled"))},apFun=function(){return 1>=countPage?!1:(apTimer=setInterval(function(){curr+=1,curr>countPage&&(curr=1),play(curr)},s),void 0)};config.prevBtn.unbind().bind("click",function(){return $(this).hasClass("disabled")?!1:(curr-=1,0>=curr&&(curr=1,$(this).addClass("disabled")),play(curr),config.nextBtn.removeClass("disabled"),!1)}),config.nextBtn.unbind().bind("click",function(){return $(this).hasClass("disabled")?!1:(curr+=1,curr>countPage&&(curr=countPage),play(curr),!1)}),ap&&(apFun(),config.obj.hover(function(){null!==apTimer&&clearInterval(apTimer)},function(){apFun()}))},XIAOMI.app.History=function(obj){var historyVal=XIAOMI.app.cookie("xm_goods_history"),itemArray=null,goodsUrl=null,listHtml="<ul class='xm-goods-sublist xm-goods-sublist-l'>";if(!historyVal)return!1;historyVal=historyVal.split(";");for(var lens=historyVal.length-1,i=0;lens>i;i+=1)itemArray=historyVal[i].split(","),goodsUrl=XIAOMI.GLOBAL_CONFIG.orderSite+"/goods/"+itemArray[3],listHtml+='<li><div class="item-name"><a href="'+goodsUrl+'">'+itemArray[1]+"</a></div>",listHtml+='<div class="item-price">'+itemArray[2]+"元</div>",listHtml+='<div class="item-thumb"><a href="'+goodsUrl+'"><img src="'+itemArray[0]+'" alt="'+itemArray[1]+'"></a></div></li>';return listHtml+="</ul>",obj?(obj.html(listHtml),void 0):listHtml},XIAOMI.app.addShopCart=function(gid,callback,obj){if(gid&&"function"==typeof callback){var ajaxUrl=XIAOMI.GLOBAL_CONFIG.orderSite+"/cart/add/"+gid;$.ajax({url:ajaxUrl,dataType:"jsonp",jsonp:"jsonpcallback",success:function(data){callback(data,obj),XIAOMI.app.updateMiniCart()}})}},XIAOMI.app.addShopCartEvent=function(options){var op={obj:".xmAddShopCart",callback:null};$.extend(op,options||{}),$(document).on("click",op.obj,function(){var gid=$(this).attr("data-gid"),isDisabled=$(this).attr("data-disabled"),isPackage=$(this).attr("data-package");if("false"===isDisabled){if($(this).attr("data-disabled","true"),!gid||"true"===isPackage||null===op.callback)return!0;XIAOMI.app.addShopCart(gid,op.callback,$(this))}return!1})},XIAOMI.app.search={speed:200,inputObj:null,keyword:null,defVal:null,init:function(){var _this=this,timeOut=null;_this.inputObj=$("#user_search").find("#keyword"),_this.inputObj.val()===default_word||_this.inputObj.css({color:"#333"}),_this.inputObj.focus(function(){$(this).val()===default_word&&$(this).val(""),_this.inputObj.css({color:"#333"})}).blur(function(){0>=$.trim($(this).val()).length&&$(this).val(_this.defVal)}).keyup(function(e){if(0>=$.trim($(this).val()).length)return _this.removeList(),!1;var key=e||event;_this.focusMove(key.keyCode),clearTimeout(timeOut),40!==key.keyCode&&38!==key.keyCode&&(timeOut=setTimeout(function(){_this.keyword=_this.inputObj.val(),_this.getResult(_this.keyword)},_this.speed))}),$("#keywordList").find("li").live("hover",function(){$(this).addClass("current").siblings().removeClass("current")}),$(document).click(function(){_this.removeList()}),_this.submit()},getResult:function(k){var _this=this;k&&$.ajax({type:"GET",url:XIAOMI.GLOBAL_CONFIG.wwwSite+"/search/tips?keyword="+encodeURIComponent(k),dataType:"jsonp",jsonp:"jsonpcallback",jsonpCallback:"xmsearch",cache:!0,success:function(data){_this.removeList(),data.length>0&&_this.formatData(data)}})},formatData:function(data){for(var listHtml="<div class='keyword-list' id='keywordList'><ul>",lens=data.length,i=0;lens>i;i+=1){var keywordStr=data[i].replace(this.keyword,"<span>"+this.keyword+"</span>");listHtml+="<li data-key='"+data[i]+"'  ><a href='"+XIAOMI.GLOBAL_CONFIG.wwwSite+"/search_"+encodeURIComponent(data[i])+"' onclick=\"_gaq.push(['_trackEvent', '搜索框', '搜索', '"+data[i]+"'])\">"+keywordStr+"</a></li>"}listHtml+="</ul><span class='arrow-border'></span><span class='arrow-bg'></span></div>",$("#user_search").append(listHtml)},focusMove:function(keyCode){var _this=this,item=$("#keywordList").find("li"),i=$("#keywordList").find(".current").index()||0,lens=item.length-1;if(38===keyCode){if(i-=1,0>i)return i=0,!1;item.eq(i).addClass("current").siblings().removeClass("current"),_this.inputObj.val(item.eq(i).attr("data-key"))}else if(40===keyCode){if(i+=1,i>lens)return i=lens,!1;item.eq(i).addClass("current").siblings().removeClass("current"),_this.inputObj.val(item.eq(i).attr("data-key"))}},removeList:function(){var list=$("#keywordList");list.length>0&&$("#keywordList").remove()},submit:function(){var _this=this;$("#user_search").submit(function(){var val=$.trim(_this.inputObj.val());return""!==val&&(val=val.replace(/[\-_'=|\\\/]/g," "),_gaq.push(["_trackEvent","搜索框","搜索",val]),window.location.href=XIAOMI.GLOBAL_CONFIG.wwwSite+"/search_"+encodeURIComponent(val)),!1})}},XIAOMI.app.miniCart={loadingStr:"<div class='loading'>数据加载中，请稍后...</div>",speed:500,init:function(){var _this=this,timeOut=null,isOn=null;return"undefined"!=typeof miniCartDisable&&miniCartDisable?!1:($("#miniCart").hover(function(){$(".header_menu_top_panel").hide(),clearTimeout(timeOut),isOn=$(this).hasClass("mini-cart-on")?!0:!1,isOn||($(this).addClass("mini-cart-on"),_this.show(),_this.getData())},function(){timeOut=setTimeout(function(){_this.close()},_this.speed)}),$("#miniCartList").hover(function(){clearTimeout(timeOut)},function(){timeOut=setTimeout(function(){_this.close()},_this.speed)}),$("#miniCartList").find("li").find(".delItem").live("click",function(){var gId=($(this).parent(),$(this).attr("gid"));return _this.delGoods(gId),!1}),void 0)},show:function(){$("#miniCartList").show(100)},close:function(){$("#miniCart").removeClass("mini-cart-on"),$("#miniCartList").html(this.loadingStr).hide()},delGoods:function(gId){var _this=this;$.ajax({type:"POST",url:XIAOMI.GLOBAL_CONFIG.orderSite+"/cart/delete/"+gId,dataType:"jsonp",jsonp:"jsonpcallback",cache:"false",success:function(data){1===data.deleteBatch&&(_this.getData(),XIAOMI.app.updateMiniCart())}})},getData:function(){var _this=this;$.ajax({type:"POST",url:XIAOMI.GLOBAL_CONFIG.orderSite+"/cart/miniNew",dataType:"jsonp",jsonp:"jsonpcallback",cache:!1,success:function(data){_this.formatData(data),XIAOMI.app.updateMiniCart()}})},formatData:function(data){if(0===data.errorno&&data.totalItem>0){var lens=data.items.length,goodsUrl=null,listHtml="<ul>",countHtml='<div class="count"><p>共计 <em>'+data.total+"</em> 件商品<strong>合计：<em>"+data.totalPrice+'元</em></strong></p><a href="'+XIAOMI.GLOBAL_CONFIG.orderSite+"/cart\"  class=\"btn btn-primary\" onclick=\"_gaq.push(['_trackEvent', '首页', 'A', '去结算']);\">去结算</a></div>";if(data.totalItem>5){var listHeight=405;listHtml="<ul style='height:"+listHeight+"px;overflow-x:hidden;overflow-y:scroll'>"}for(var i=0;lens>i;i+=1)0===data.items[i].noLink?(goodsUrl="/goods/"+data.items[i].product_id,listHtml+='<li class="clearfix"><a href="'+goodsUrl+'" class="pic"><img alt="" src="'+data.items[i].image_url+'"></a><a href="'+goodsUrl+'" class="name">'+data.items[i].product_name+'</a><span class="price">'+data.items[i].salePrice+"元 x "+data.items[i].num+'</span><a href="#" class="icon-common icon-common-close  delItem" gid="'+data.items[i].itemId+'"></a></li>'):listHtml+='<li class="clearfix"><span class="pic"><img alt="" src="'+data.items[i].image_url+'"></span><span   class="name">'+data.items[i].product_name+'</span><span class="price">'+data.items[i].salePrice+"元 x "+data.items[i].num+'</span><span class="icon-common icon-common-close  delItem" gid="'+data.items[i].itemId+'"></span></li>';listHtml+="</ul>",$("#miniCartList").html(listHtml+countHtml)}else $("#miniCartList").html("<p class='tip'>购物车中还没有商品，赶紧选购吧！</p>")}},XIAOMI.app.getRegions={getUrl:"/region/index",getData:function(parent,target,sId){var _this=this;$.ajax({type:"GET",url:_this.getUrl,data:"parent="+parent,dataType:"json",success:function(data){data&&_this.formatData(data,target,sId)}})},formatData:function(jsonData,target,sId){for(var dataArray=jsonData.regions,lens=dataArray.length,obj=$("#"+target),options="<option value='0'>"+obj.children("option").eq(0).html()+"</option>",i=0;lens>i;i+=1){var isSelected=dataArray[i].region_id===sId?"selected":"";options+="<option zipcode='"+dataArray[i].zipcode+"' value='"+dataArray[i].region_id+"'"+isSelected+">"+dataArray[i].region_name+"</option>"}$("#"+target).html(options).attr("disabled",!1)}},XIAOMI.countdown={countdown:function(nowTime,endTime){var _this=this,endTimeNum=endTime,d=endTimeNum-nowTime,second=parseInt(d%60,10),minite=parseInt(d/60%60,10),hour=parseInt(d/3600%24,10),day=parseInt(d/3600/24,10),timeArray=[""+second,""+minite,""+hour];return 1>=d?["",!0]:[parseInt(timeArray[2],10)+parseInt(24*day,10)+" : "+_this.formatNum(timeArray[1])+" : "+_this.formatNum(timeArray[0]),!1]},formatNum:function(num){return 10>num?"0"+num:num},init:function(mnowtime,endtime){var _this=this,startTime=mnowtime||(new Date).getTime()/1e3,endTime=endtime;if($(".xmcounttime"))var arr=_this.countdown(startTime,endTime),stop=setInterval(function(){arr=_this.countdown(startTime,endTime),arr[1]?(clearInterval(stop),$(".xmcounttime").html('<label class="timebtn" >秒杀正在进行中...</label>')):(startTime++,$(".xmcounttime").html('<label id="xmtime" class="time"><span>剩余时间</span>'+arr[0]+"</label>"))},1e3)}},XIAOMI.app.selector={defaultOption:{reorder:!1,buildLI:function(index,obj,elmUL){var objLI=$('<li data-index="'+index+'"><span>'+obj.text+"</span></li>");obj.selected&&objLI.addClass("selected"),elmUL.append(objLI)},afterChange:function(){}},init:function(elm,opt){function reorderList(elm){elm.insertBefore(elm.closest("ul").children("li")[0]),elmText.text(elm.text())}var options,elmSelect,elmWrap,elmText,elmList,elmArrow,_this=this,data=[];return 0===elm.length?elm:elm.length>1?(elm.each(function(){_this.init($(this),{})}),this):(options=$.extend({},_this.defaultOption,opt),elmSelect=elm,elmWrap=$('<div class="xm-select"></div>').insertAfter(elmSelect),elmText=$('<div class="dropdown-text"></div>'),elmList=$('<ul class="dropdown-menu"></ul>'),elmArrow=$('<span class="arrow-down"></span>'),elmSelect.children("option").each(function(){data.push({text:$(this).text(),value:$(this).attr("value"),selected:$(this).attr("selected")})}),$(data).each(function(index,obj){options.buildLI(index,obj,elmList)}),elmWrap.append(elmText,elmList,elmArrow,elmSelect),elmSelect.hide(),options.reorder===!0?0!==elmList.children("li").index(elmList.children(".selected"))?reorderList(elmList.children(".selected")):elmText.text(data[0].text):elmText.text(data[0].text),elmList.on("click","li",function(){var val=elmSelect.children("option").eq($(this).attr("data-index")).val();elmSelect.val(val).change(),$(this).addClass("selected").siblings("li").removeClass("selected"),options.reorder===!0?0!==elmList.children("li").index(this)&&(reorderList($(this)),elmList.hide()):(elmText.text($(this).text()),elmList.hide()),options.afterChange(val)}),elmWrap.on({mouseover:function(){elmWrap.addClass("toggled"),elmList.show()},mouseout:function(){elmWrap.removeClass("toggled"),elmList.hide()}}),void 0)}},XIAOMI.app.navigation={init:function(){var _this=this;this.showlist=$("#showlist"),this.navswitch=$("#btnnav"),this.showlistUL=$("#showlistUL"),this.showlastli=$("#showlastli"),this.delay=100,this.isopen=!1,this.stopswitch=null,this.stopswitchup=null,"undefined"!=typeof mileftnav&&mileftnav&&(this.isopen=!0),_this.events()},events:function(){var _this=this;_this.domInitAction(),_this.analytics(),_this.navSwitchAction(),_this.liAction()},domInitAction:function(){var _this=this,template=doT.template($("#nav-list-template").html());_this.showlastli.before(template(categoryTree)),_this.isopen?(_this.showlist.show(),_this.navswitch.find(".tri").hide()):(_this.showlist.hide(),_this.navswitch.find(".tri").fadeIn(),$(".nav").addClass("navon")),_this.showlistUL.find("li:gt(12)").hide(),_this.showlistUL.find("li:visible").last().css({"border-bottom":"none"}),_this.showlastli.show()},analytics:function(){var page="分类导航",mstPage="H",util="C",position="A",elements=$("#showlistUL").find("a.tit"),levelEles=$("#showlistUL").find(".show"),bindEvent=function(links,level){$.each(links,function(k,v){var paramURL=$(v).attr("href"),paramText=XIAOMI.lang.trim($(v).text()),paramIndex=k,mstPosition=mstPage+"-"+util+"-"+position+paramIndex,GAPostion=paramText;if(1===level)$(v).siblings(".show").find("a").attr({"data-position":mstPosition,"data-gaposition":GAPostion}),GAparmas="'"+page+"', '"+GAPostion+"', '"+"0"+"'",mstParmas="'"+mstPage+"', '"+mstPosition+"_0"+"', '"+paramURL+"'";else if(2===level){var dataMstPosition=$(v).attr("data-position"),dataGaposition=$(v).attr("data-gaposition"),mstIndex=k+1;GAparmas="'"+page+"', '"+dataGaposition+"', '"+GAPostion+"'",mstParmas="'"+mstPage+"', '"+dataMstPosition+"_"+mstIndex+"', '"+paramURL+"'"}$(v).attr("onclick","_gaq.push(['_trackEvent',"+GAparmas+"]);_msq.push(['trackEvent',event,"+mstParmas+"])")})};bindEvent(elements,1);for(var i=0;levelEles.length>i;i++){var links=levelEles.eq(i).find("a");bindEvent(links,2)}},navSwitchAction:function(){var _this=this;_this.navswitch.live("mouseenter",function(){_this.isopen||(_this.stopswitch&&clearTimeout(_this.stopswitch),_this.stopswitchup&&clearTimeout(_this.stopswitchup),_this.showlist.fadeIn(),_this.navswitch.find(".tri").addClass("icon-header-arrow"))}),_this.navswitch.live("mouseleave",function(){_this.isopen||(_this.stopswitch=setTimeout(function(){_this.showlist.fadeOut(),_this.navswitch.find(".tri").removeClass("icon-header-arrow")},_this.delay))})},liAction:function(){var _this=this,stopOver=null,stopLeave=null;_this.showlist.find("li").live("mouseenter",function(){var $this=$(this);_this.showlist.find(".show"),_this.showlistUL.find("li:visible").length,stopOver&&clearTimeout(stopOver),stopLeave&&clearTimeout(stopLeave),stopOver=setTimeout(function(){_this.showlist.find(".show,.tri").hide(),_this.showlist.find("li").removeClass("on"),$this.index(),$this.find(".show").height(),$this.find("dl").hasClass("firstdl")?$this.find(".show").css({top:"-46px"}):$this.find(".show").css({top:"-27px"}),$this.find(".show,.tri").show(),$this.addClass("on")},_this.delay)}),_this.showlist.find("li").live("mouseleave",function(ev){function mousePosition(ev){return ev.pageX||ev.pageY?{x:ev.pageX,y:ev.pageY}:{x:ev.clientX+document.body.scrollLeft-document.body.clientLeft,y:ev.clientY+document.body.scrollTop-document.body.clientTop}}var $this=$(this);try{if(0!==$this.find(".show").length){var y1=$this.find(".tit").offset().top,x1=$this.find(".tit").offset().left,y2=y1+41,x2=x1,x3=$this.find(".show").offset().left,y3=$this.find(".show").offset().top,width=$this.find(".show").width(),x4=x3,y4=y3+$this.find(".show").height(),x5=x3+width;ev=ev||window.event;var mousePos=mousePosition(ev),flag1=!1,Rx=mousePos.x,Ry=mousePos.y,flag2=!1,sf_a=y1-y3/(x3-x1),sf_b=y1-Ry/(Rx-x1),flag3=!1,sg_a=y4-y2/(x4-x2),sg_b=y4-Ry/(x4-Rx),flag4=!1;if(Rx>x1&&x3>Rx&&y2>Ry&&Ry>y1?flag1=!0:(sf_a>sf_b&&Rx>x1&&x3>Rx&&Ry>y3&&y1>Ry&&(flag2=!0),sg_b>sg_a&&Rx>x1&&x3>Rx&&Ry>y4&&y2>Ry&&(flag3=!0),Rx>x3&&x5>Rx&&Ry>y3&&y4>Ry&&(flag4=!0)),flag1||flag2||flag3||flag4)return!1}}catch(e){return!1}stopLeave=setTimeout(function(){$this.find(".show,.tri").hide(),$this.removeClass("on")},_this.delay)}),_this.showlist.live("mouseenter",function(){_this.isopen||_this.stopswitch&&clearTimeout(_this.stopswitch)}),_this.showlist.live("mouseleave",function(){_this.isopen||(_this.stopswitchup=setTimeout(function(){_this.showlist.hide(),_this.navswitch.find(".tri").removeClass("icon-header-arrow")},_this.delay))})}},XIAOMI.app.header={init:function(){var _this=this;this.xmphonelistarr=$("#xmphonelistarr"),this.allCateTimerList=null,_this.events()},events:function(){var _this=this;_this.domInit(),_this.phoneAction(),_this.weixin()},domInit:function(){$(".hdbtnsearch").hover(function(){$(".icon-common-searchhover").show()},function(){$(".icon-common-searchhover").hide()})},phoneAction:function(){var _this=this;_this.xmphonelistarr.hover(function(){_this.xmphonelistarr.find(".lnk").addClass("on"),$(this).find("dl").show(),$(this).find(".tri").show()},function(){_this.xmphonelistarr.find(".lnk").removeClass("on"),$(this).find("dl").hide(),$(this).find(".tri").hide()})},weixin:function(){$("#txweixin").click(function(){var boxWidth=$("#boxweixin").attr("data-width"),boxHeight=$("#boxweixin").attr("data-height");$("#boxweixin").css({width:boxWidth,height:boxHeight}).modal({backdrop:!0,keyboard:!0,show:!0})})}},$(function(){var oLogin=new XIAOMI.app.miniLogin;oLogin.init(),XIAOMI.app.search.init(),XIAOMI.app.miniCart.init(),XIAOMI.app.updateMiniCart(),XIAOMI.app.navigation.init(),XIAOMI.app.googleAnalytics([".nav .lnks-li"],{page:"导航",position:["A1"],mstPage:"H",mstFunction:"N",isMst:!0}),XIAOMI.app.googleAnalytics([".hot"],{page:"搜索热词",position:["搜索热词"],url:!1})});;!function($){"use strict";var Modal=function(element,options){this.options=options,this.$element=$(element).delegate('[data-dismiss="modal"]',"click.dismiss.modal",$.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};Modal.prototype={constructor:Modal,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var that=this,e=$.Event("show");this.$element.trigger(e),this.isShown||e.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.backdrop(function(){var transition=$.support.transition&&that.$element.hasClass("fade");that.$element.parent().length||that.$element.appendTo(document.body),that.$element.show(),transition&&that.$element[0].offsetWidth,that.$element.addClass("in").attr("aria-hidden",!1),that.enforceFocus(),transition?that.$element.one($.support.transition.end,function(){that.$element.focus().trigger("shown")}):that.$element.focus().trigger("shown")}))},hide:function(e){e&&e.preventDefault(),e=$.Event("hide"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),$(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),$.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal())},enforceFocus:function(){var that=this;$(document).on("focusin.modal",function(e){that.$element[0]===e.target||that.$element.has(e.target).length||that.$element.focus()})},escape:function(){var that=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(e){27==e.which&&that.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var that=this,timeout=setTimeout(function(){that.$element.off($.support.transition.end),that.hideModal()},500);this.$element.one($.support.transition.end,function(){clearTimeout(timeout),that.hideModal()})},hideModal:function(){var that=this;this.$element.hide(),this.backdrop(function(){that.removeBackdrop(),that.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(callback){var animate=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate,pageHeight=$(document).height(),pageWidth="100%";if(this.$backdrop=$('<div class="modal-backdrop '+animate+'" />').appendTo(document.body),this.$backdrop.css({width:pageWidth,height:pageHeight}).click("static"==this.options.backdrop?$.proxy(this.$element[0].focus,this.$element[0]):$.proxy(this.hide,this)),doAnimate&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!callback)return;doAnimate?this.$backdrop.one($.support.transition.end,callback):callback()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),$.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one($.support.transition.end,callback):callback()):callback&&callback()}};var old=$.fn.modal;$.fn.modal=function(option){return this.each(function(){var $this=$(this),data=$this.data("modal"),options=$.extend({},$.fn.modal.defaults,$this.data(),"object"==typeof option&&option);data||$this.data("modal",data=new Modal(this,options)),"string"==typeof option?data[option]():options.show&&data.show()})},$.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},$.fn.modal.Constructor=Modal,$.fn.modal.noConflict=function(){return $.fn.modal=old,this},$(document).on("click.modal.data-api",'[data-toggle="modal"]',function(e){var $this=$(this),href=$this.attr("href"),$target=$($this.attr("data-target")||href&&href.replace(/.*(?=#[^\s]+$)/,"")),option=$target.data("modal")?"toggle":$.extend({remote:!/#/.test(href)&&href},$target.data(),$this.data());e.preventDefault(),$target.modal(option).one("hide",function(){$this.focus()})})}(window.jQuery);;(function(){"use strict";function encodeHTMLSource(){var encodeHTMLRules={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},matchHTML=/&(?!#?\w+;)|<|>|"|'|\//g;return function(){return this?this.replace(matchHTML,function(m){return encodeHTMLRules[m]||m}):this}}function resolveDefs(c,block,def){return("string"==typeof block?block:""+block).replace(c.define||skip,function(m,code,assign,value){return 0===code.indexOf("def.")&&(code=code.substring(4)),code in def||(":"===assign?(c.defineParams&&value.replace(c.defineParams,function(m,param,v){def[code]={arg:param,text:v}}),code in def||(def[code]=value)):Function("def","def['"+code+"']="+value)(def)),""}).replace(c.use||skip,function(m,code){c.useParams&&(code=code.replace(c.useParams,function(m,s,d,param){if(def[d]&&def[d].arg&&param){var rw=(d+":"+param).replace(/'|\\/g,"_");return def.__exp=def.__exp||{},def.__exp[rw]=def[d].text.replace(RegExp("(^|[^\\w$])"+def[d].arg+"([^\\w$])","g"),"$1"+param+"$2"),s+"def.__exp['"+rw+"']"}}));var v=Function("def","return "+code)(def);return v?resolveDefs(c,v,def):v})}function unescape(code){return code.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var global,doT={version:"1.0.0",templateSettings:{evaluate:/\{\{([\s\S]+?\}?)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1},template:void 0,compile:void 0};"undefined"!=typeof module&&module.exports?module.exports=doT:"function"==typeof define&&define.amd?define(function(){return doT}):(global=function(){return this||(0,eval)("this")}(),global.doT=doT),String.prototype.encodeHTML=encodeHTMLSource();var startend={append:{start:"'+(",end:")+'",endencode:"||'').toString().encodeHTML()+'"},split:{start:"';out+=(",end:");out+='",endencode:"||'').toString().encodeHTML();out+='"}},skip=/$^/;doT.template=function(tmpl,c,def){c=c||doT.templateSettings;var needhtmlencode,indv,cse=c.append?startend.append:startend.split,sid=0,str=c.use||c.define?resolveDefs(c,tmpl,def||{}):tmpl;str=("var out='"+(c.strip?str.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):str).replace(/'|\\/g,"\\$&").replace(c.interpolate||skip,function(m,code){return cse.start+unescape(code)+cse.end}).replace(c.encode||skip,function(m,code){return needhtmlencode=!0,cse.start+unescape(code)+cse.endencode}).replace(c.conditional||skip,function(m,elsecase,code){return elsecase?code?"';}else if("+unescape(code)+"){out+='":"';}else{out+='":code?"';if("+unescape(code)+"){out+='":"';}out+='"}).replace(c.iterate||skip,function(m,iterate,vname,iname){return iterate?(sid+=1,indv=iname||"i"+sid,iterate=unescape(iterate),"';var arr"+sid+"="+iterate+";if(arr"+sid+"){var "+vname+","+indv+"=-1,l"+sid+"=arr"+sid+".length-1;while("+indv+"<l"+sid+"){"+vname+"=arr"+sid+"["+indv+"+=1];out+='"):"';} } out+='"}).replace(c.evaluate||skip,function(m,code){return"';"+unescape(code)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,"").replace(/(\s|;|\}|^|\{)out\+=''\+/g,"$1out+="),needhtmlencode&&c.selfcontained&&(str="String.prototype.encodeHTML=("+(""+encodeHTMLSource)+"());"+str);try{return Function(c.varname,str)}catch(e){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+str),e}},doT.compile=function(tmpl,def){return doT.template(tmpl,null,def)}})();